var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,i=(t,r,n)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[r]=n,l=(e,t)=>{for(var r in t||(t={}))o.call(t,r)&&i(e,r,t[r]);if(n)for(var r of n(t))a.call(t,r)&&i(e,r,t[r]);return e},s=(e,t,r)=>new Promise(((n,o)=>{var a=e=>{try{l(r.next(e))}catch(t){o(t)}},i=e=>{try{l(r.throw(e))}catch(t){o(t)}},l=e=>e.done?n(e.value):Promise.resolve(e.value).then(a,i);l((r=r.apply(e,t)).next())}));import{B as u,a as c}from"./index28.js";import{d8 as p,x as d,bP as m,a as f,b as g,bw as y,r as h,v as b,e as w,o as v,i as M,j as P,k,z as O,m as j,A as C,B as _,l as D}from"./index.js";import{u as I}from"./usePrompt.js";import"./Prompt.js";import{d as x,b as R}from"./base64Conver.js";function B(){return p.get({url:"/plugin/miao/help"},{errorMessageMode:"modal"})}function S(e,t,r,n){return s(this,null,(function*(){let o=new FormData;return o.append("helpCfg",JSON.stringify(d(e),null,2)),o.append("helpList",JSON.stringify(d(t),null,2)),o.append("icon",yield function(e){return s(this,null,(function*(){let{createMessage:t}=m(),r=document.createElement("canvas");r.width=1e3,r.height=100*Math.ceil((e.length-1)/10);let n,o,a=r.getContext("2d");for(let l=0;l<e.length;l++){let r=e[l+1];if(!r)continue;let s=new Image;o=Math.floor(l/10),n=l-10*o,s.src=r;try{yield A(s)}catch(i){t.error(`第 ${l+1} 个图标保存失败`);continue}a.drawImage(s,100*n,100*o,100,100)}return new Promise((e=>r.toBlob(e)))}))}(d(r))),d(n)&&o.append("main",yield x(d(n))),p.post({url:"/plugin/miao/help",params:o,timeout:-1},{errorMessageMode:"modal"})}))}function L(e){return s(this,null,(function*(){e||(e=yield function(e){return s(this,null,(function*(){let t=(yield p.get({url:e,responseType:"blob",timeout:-1},{isTransformResponse:!1,isReturnNativeResponse:!0,errorMessageMode:"modal"})).data;return yield R(t)}))}("/plugin/miao/help/icon"));let t=new Image;return t.src=e,yield A(t),yield function(e){return new Promise((t=>{e.setAttribute("crossOrigin","Anonymous");let r=document.createElement("canvas");r.width=100,r.height=100;let n=r.getContext("2d");if(n){let o,a,i=[],l=Math.round(e.height/10);for(let t=0;t<l;t++)a=Math.floor(t/10),o=t-10*a,n.drawImage(e,100*o,100*a,100,100,0,0,100,100),i[t+1]=r.toDataURL(),n.clearRect(0,0,100,100);t(i)}else t(null)}))}(t)}))}function A(e){return s(this,null,(function*(){return new Promise(((t,r)=>{e.onload=t,e.onerror=r}))}))}const N=g({name:"BackupDrawer",components:{BasicDrawer:u},emits:["register","reload"],setup(e,{emit:n}){const o=y(),{createMessage:a}=m(),{createPrompt:i}=I(),u=h(!1),f=h([]),[g,{closeDrawer:w,setDrawerProps:v}]=c((function(){M()}));function M(){return s(this,null,(function*(){try{k(!0),f.value=(yield p.get({url:"/plugin/miao/help/backup/list"},{errorMessageMode:"modal"})).reverse()}finally{k(!1)}}))}function P(){w()}function k(e){u.value=e,v({confirmLoading:e})}return{getProps:b((()=>{let n={width:document.body.clientWidth>=768?700:"100%",title:"喵喵帮助备份",confirmLoading:d(u)};var a;return a=l(l(l({},d(o)),n),e),t(a,r({onOk:P,onCancel:P,onRegister:g}))})),loading:u,backupList:f,onAdd:function(){i({title:"新增备份",required:!0,placeholder:"请输入备注",onOk(e){return s(this,null,(function*(){var t;yield(t=e,p.post({url:"/plugin/miao/help/backup",params:{remark:t}},{errorMessageMode:"modal"})),yield M()}))}})},onRollback:function(e){return s(this,null,(function*(){try{k(!0),yield function(e){return p.post({url:"/plugin/miao/help/backup/restore",params:{id:e}},{errorMessageMode:"modal"})}(e),n("reload")}finally{k(!1)}}))},onDelete:function(e){return s(this,null,(function*(){try{if(e.isInit)return void a.warn("初始备份不可删除");k(!0),yield(t=e.id,p.delete({url:"/plugin/miao/help/backup/delete",params:{id:t}},{errorMessageMode:"modal"})),yield M()}finally{k(!1)}var t}))}}}}),z={style:{"margin-bottom":"8px"}},E=D("新增备份");var T=f(N,[["render",function(e,t,r,n,o,a){const i=w("a-button"),l=w("a-popconfirm"),s=w("a-list-item-meta"),u=w("a-list-item"),c=w("a-list"),p=w("a-spin"),d=w("BasicDrawer");return v(),M(d,C(_(e.getProps)),{default:P((()=>[k(p,{wrapperClassName:"p-2",spinning:e.loading},{default:P((()=>[O("div",z,[k(i,{type:"primary",preIcon:"ant-design:plus",onClick:e.onAdd},{default:P((()=>[E])),_:1},8,["onClick"])]),k(c,{size:"large",bordered:"",dataSource:e.backupList},{renderItem:P((({item:t})=>[k(u,null,{actions:P((()=>[k(l,{title:"确定要还原吗？",placement:"left",onConfirm:()=>e.onRollback(t.id)},{default:P((()=>[k(i,{type:"primary",shape:"circle",preIcon:"ant-design:undo"})])),_:2},1032,["onConfirm"]),k(l,{title:"确定要删除吗？",placement:"left",onConfirm:()=>e.onDelete(t)},{default:P((()=>[k(i,{type:"primary",shape:"circle",danger:"",preIcon:"ant-design:delete"})])),_:2},1032,["onConfirm"])])),default:P((()=>[k(s,{description:t.time},{title:P((()=>[O("span",null,j(t.remark),1)])),_:2},1032,["description"])])),_:2},1024)])),_:1},8,["dataSource"])])),_:1},8,["spinning"])])),_:1},16)}]]),J=Object.freeze(Object.defineProperty({__proto__:null,default:T},Symbol.toStringTag,{value:"Module"}));export{T as B,L as a,J as b,B as g,S as s};
