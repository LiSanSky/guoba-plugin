import{a as e,b as l,U as a,r as t,R as s,fU as i,w as o,J as d,bE as n,e as c,o as u,f as r,l as m,k as p,D as v,i as f,ak as h,a2 as g,H as x,db as D,z as I,x as y,fV as b,c3 as w,F as k,A as L,C,m as _,e9 as j}from"./index.js";import U from"./SelectIconModal.js";import"./IconUploader.js";import"./esm.js";const B=e=>(L("data-v-4baeee83"),e=e(),C(),e),z=[_(" 编辑内容 "),B((()=>v("span",{class:"tip"},"按住这里可拖动",-1)))],M={class:"p-4"},R={class:"row"},A=B((()=>v("div",null,"分组",-1))),O={class:"flex-1"},$={class:"row"},E=B((()=>v("div",null,"仅主人",-1))),N={class:"flex justify-between align-center flex-wrap"},V={class:"flex justify-start"},S={class:"flex flex-1 justify-end"},T=_("添加项目"),F=_("添加分组"),H=_("删除该组"),J={key:0},P={class:"row"},q=B((()=>v("div",null,"标题",-1))),G={class:"flex-1"},K={class:"row"},Q=B((()=>v("div",null,"描述",-1))),W={class:"flex-1"},X={class:"flex justify-between align-center"},Y={class:"flex justify-start move-buttons"},Z={class:"flex flex-1 justify-end"},ee=_("添加项目"),le=_("删除该项");var ae=e(l({props:{panelCls:String,helpList:Object,modelData:Object,iconB64List:Array},emits:["update:modelData"],setup(e,{emit:l}){const L=e,{prefixCls:C}=a("miao-plugin-edit-modal"),{createConfirm:_}=j(),B=t(!0),ae=s((()=>B.value?"model-event-none":"")),te=t(!1);let se=!1;const ie=()=>{let e=L.modelData.groupIndex;L.helpList.splice(e,0,{group:"未命名分组",list:[]}),L.modelData.group=L.helpList[e],L.modelData.cellIndex=L.modelData.cell=null},oe=()=>{var e;let l=L.helpList[L.modelData.groupIndex];Array.isArray(l.list)||(l.list=[]);let a=null!=(e=L.modelData.cellIndex)?e:0;l.list.splice(a,0,{icon:1,title:"未命名项目",desc:"请添加描述"}),L.modelData.cell=l.list[a],L.modelData.cellIndex=a},de=e=>{let l,a=L.helpList,t=L.modelData.groupIndex;l=a[t],a[t]=a[t+e],a[t+e]=l,L.modelData.groupIndex+=e},ne=e=>{if(-1===e&&0===L.modelData.cellIndex)return void ce(e);if(1===e&&L.modelData.cellIndex===L.helpList[L.modelData.groupIndex].list.length-1)return void ce(e);let l,a=L.helpList[L.modelData.groupIndex].list,t=L.modelData.cellIndex;l=a[t],a[t]=a[t+e],a[t+e]=l,L.modelData.cellIndex+=e};function ce(e){let a=-1===e?"上":"下";B.value=!1,_({title:"跨分组移动",iconType:"warning",content:`确定要将该项目移动到${a}一个分组吗？`,onOk:()=>{let a,{modelData:t,helpList:s}=L,{cell:i,groupIndex:o,cellIndex:d}=t,n=s[o],c=s[o+e];-1===e?(c.list.push(i),n.list.splice(d,1),a=c.list.length-1):(c.list.unshift(i),n.list.splice(d,1),a=0),l("update:modelData",Object.assign(t,{cellIndex:a,group:c,groupIndex:o+e}))},afterClose:()=>B.value=!0})}function ue(e){let{modelData:l,helpList:a}=L;return-1===e?0===l.groupIndex&&0===l.cellIndex:1===e&&(l.groupIndex===a.length-1&&l.cellIndex===a[l.groupIndex].list.length-1)}const re=()=>{L.helpList.splice(L.modelData.groupIndex,1),L.modelData.show=!1},me=()=>{let e=L.helpList[L.modelData.groupIndex],l=L.modelData.cellIndex;if(e.list.splice(l,1),0==e.list.length)L.modelData.cell=null,L.modelData.cellIndex=null;else{let a=l;a>=e.list.length&&(a=e.list.length-1),L.modelData.cell=e.list[a],L.modelData.cellIndex=a}},pe=()=>{te.value=!0,se=!0},ve=t(null),{x:fe,y:he,isDragging:ge}=i(ve),xe=t(0),De=t(0),Ie=t(!1),ye=t(0),be=t(0),we=t(0),ke=t(0),Le=t({left:0,right:0,top:0,bottom:0});o([fe,he],(()=>{if(!Ie.value){xe.value=fe.value,De.value=he.value;const e=document.body.getBoundingClientRect(),l=ve.value.getBoundingClientRect();Le.value.right=e.width-l.width,Le.value.bottom=e.height-l.height,we.value=ye.value,ke.value=be.value}Ie.value=!0})),o(ge,(()=>{ge||(Ie.value=!1)})),d((()=>{Ie.value&&(ye.value=we.value+Math.min(Math.max(Le.value.left,fe.value),Le.value.right)-xe.value,be.value=ke.value+Math.min(Math.max(Le.value.top,he.value),Le.value.bottom)-De.value)}));const Ce=s((()=>({transform:`translate(${ye.value}px, ${be.value}px)`})));function _e(e){var l,a,t;if(null==(l=L.modelData)?void 0:l.show){if(!B.value)return;if(se)return;let l=e.composedPath();for(let e of l)if((null==(a=e.classList)?void 0:a.contains(C))||(null==(t=e.classList)?void 0:t.contains(L.panelCls)))return;L.modelData.show=!1}}function je(){se=!1}return window.addEventListener("click",_e),n((()=>{window.removeEventListener("click",_e)})),(l,a)=>{const t=c("a-input"),s=c("Icon"),i=c("a-button"),o=c("a-popconfirm"),d=c("a-divider");return u(),r(k,null,[m(x(b),{visible:e.modelData.show,"onUpdate:visible":a[8]||(a[8]=l=>e.modelData.show=l),footer:null,mask:!1,class:y(x(C)),wrapClassName:x(ae)},{title:p((()=>[v("div",{ref_key:"modalTitleRef",ref:ve,style:{width:"100%",cursor:"move",margin:"0"}},z,512)])),modalRender:p((({originVNode:e})=>[v("div",{style:g(x(Ce))},[(u(),f(h(e)))],4)])),default:p((()=>[v("div",M,[v("div",R,[A,v("div",O,[m(t,{value:e.modelData.group.group,"onUpdate:value":a[0]||(a[0]=l=>e.modelData.group.group=l),placeholder:"分组"},null,8,["value"])])]),v("div",$,[E,m(x(D),{checked:e.modelData.group.auth,"onUpdate:checked":a[1]||(a[1]=l=>e.modelData.group.auth=l),checkedValue:"master","checked-children":"是","un-checked-children":"否"},null,8,["checked"])]),v("div",N,[v("div",V,[m(i,{class:"ml-4",disabled:0===e.modelData.groupIndex,type:"primary",shape:"circle",size:"medium",onClick:a[2]||(a[2]=e=>de(-1))},{default:p((()=>[m(s,{icon:"akar-icons:arrow-up"})])),_:1},8,["disabled"]),m(i,{class:"ml-4",disabled:e.modelData.groupIndex===e.helpList.length-1,type:"primary",shape:"circle",size:"medium",onClick:a[3]||(a[3]=e=>de(1))},{default:p((()=>[m(s,{icon:"akar-icons:arrow-down"})])),_:1},8,["disabled"])]),v("div",S,[e.modelData.cell?I("",!0):(u(),f(i,{key:0,class:"ml-4",onClick:oe},{default:p((()=>[T])),_:1})),m(i,{class:"ml-4",type:"success",onClick:ie},{default:p((()=>[F])),_:1}),m(o,{title:"确定删除？",onConfirm:re},{default:p((()=>[m(i,{class:"ml-4",type:"default",danger:""},{default:p((()=>[H])),_:1})])),_:1})])]),e.modelData.cell?(u(),r("div",J,[m(d,{style:{margin:"16px 0"}}),v("div",{class:"icon",onClick:pe,style:g(`background: url(${e.iconB64List[e.modelData.cell.icon]}) 0 0 no-repeat`)},null,4),v("div",P,[q,v("div",G,[m(t,{value:e.modelData.cell.title,"onUpdate:value":a[4]||(a[4]=l=>e.modelData.cell.title=l),placeholder:"标题"},null,8,["value"])])]),v("div",K,[Q,v("div",W,[m(t,{value:e.modelData.cell.desc,"onUpdate:value":a[5]||(a[5]=l=>e.modelData.cell.desc=l),placeholder:"描述"},null,8,["value"])])]),v("div",X,[v("div",Y,[m(i,{class:y(["ml-4",["ml-4",{warn:0===e.modelData.cellIndex}]]),disabled:ue(-1),type:"primary",shape:"circle",size:"medium",onClick:a[6]||(a[6]=e=>ne(-1))},{default:p((()=>[m(s,{icon:"akar-icons:arrow-left"})])),_:1},8,["class","disabled"]),m(i,{class:y(["ml-4",["ml-4",{warn:e.modelData.cellIndex===e.helpList[e.modelData.groupIndex].list.length-1}]]),disabled:ue(1),type:"primary",shape:"circle",size:"medium",onClick:a[7]||(a[7]=e=>ne(1))},{default:p((()=>[m(s,{icon:"akar-icons:arrow-right"})])),_:1},8,["class","disabled"])]),v("div",Z,[m(i,{class:"ml-4",type:"success",onClick:oe},{default:p((()=>[ee])),_:1}),m(o,{title:"确定删除？",onConfirm:me},{default:p((()=>[m(i,{class:"ml-4",type:"default",danger:""},{default:p((()=>[le])),_:1})])),_:1})])])])):I("",!0)])])),_:1},8,["visible","class","wrapClassName"]),e.modelData.cell?(u(),f(U,{key:0,visible:te.value,"onUpdate:visible":a[9]||(a[9]=e=>te.value=e),cell:e.modelData.cell,"onUpdate:cell":a[10]||(a[10]=l=>e.modelData.cell=l),iconB64List:e.iconB64List,"onUpdate:iconB64List":a[11]||(a[11]=e=>w(iconB64List)?iconB64List.value=e:null),afterClose:je},null,8,["visible","cell","iconB64List"])):I("",!0)],64)}}}),[["__scopeId","data-v-4baeee83"]]);export{ae as default};
