var e=Object.defineProperty,t=Object.defineProperties,l=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,i=(t,l,o)=>l in t?e(t,l,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[l]=o,s=(e,t,l)=>new Promise(((o,a)=>{var n=e=>{try{s(l.next(e))}catch(t){a(t)}},i=e=>{try{s(l.throw(e))}catch(t){a(t)}},s=e=>e.done?o(e.value):Promise.resolve(e.value).then(n,i);s((l=l.apply(e,t)).next())}));import r from"./EditBodyModal.js";import{b as p,ej as c,b4 as d,U as u,E as m,r as h,w as g,e as b,o as f,f as v,D as y,l as B,k as j,a2 as C,q as x,F as $,h as L,i as w,H as k,z as D,c3 as O,x as M,m as I,b0 as S,e9 as P}from"./index.js";import{c as U}from"./common.js";import{HelpTable as N}from"./HelpComps.js";import E from"./UploadIconHelpModal.js";import{b as z,a as F}from"./miao.api.js";import{l as R}from"./lodash.default.js";import"./SelectIconModal.js";import"./IconUploader.js";import"./esm.js";import"./21ae6624.js";import"./base64Conver.js";import"./throttle.js";import"./merge.js";const A={class:"container"},H={class:"setting-box"},W=y("input",{type:"file",id:"upload-bg",style:{display:"none"},name:"icon",accept:"image/bmp,image/jpeg,image/png"},null,-1),T=y("input",{type:"file",id:"upload-icon",style:{display:"none"},name:"icon",accept:"image/png"},null,-1),V={class:"info-box"},_={class:"head-box type"},q={class:"title"},Y={class:"label"},G=["onClick"],J={class:"copyright"},K=I(" Created By Yunzai-Bot "),Q={class:"version"},X=I(" & Miao-Plugin "),Z={class:"version"},ee=p({props:{helpCfg:Object,helpList:Object,bgB64:String,mainB64:String,cacheVer:Number,themeName:String,themeNames:Array,iconB64List:Array,modelData:Object,themeStyle:Object,versions:Object},emits:["update:themeStyle","update:modelData","update:mainB64","update:iconB64List","open-setting"],setup(e,{emit:p}){const I=e,ee=c(),te=d(),{prefixCls:le}=u("miao-plugin-help-panel"),{createMessage:oe}=P(),[ae,ne]=m(),ie=h(1),se=h(3),re=h(850),pe=()=>{let e=function(){let{helpCfg:e}=I;if(!e)return{style:"",colCount:3};let t=Math.min(5,Math.max(parseInt(null==e?void 0:e.colCount)||3,2)),l=Math.min(500,Math.max(100,parseInt(null==e?void 0:e.colWidth)||265)),o=Math.min(2500,Math.max(800,t*l+30)),a=[];a.push(`.${le} { width:${o}px; }`),a.push(`.${le} .help-table .td,.help-table .th{width:${100/t}%}`);let n=`/api/plugin/miao/help/theme/$s?token=${te.liteToken}&themeName=${I.themeName}&_v=${I.cacheVer}`,i=n.replace("$s","bg"),s=n.replace("$s","main");I.mainB64&&(s=I.mainB64);let r=`background: url(${s}) top left/100% auto no-repeat,url(${i})`;a.push(`.${le} .container { width:${o}px; ${r}; }`);let p=function(e,t,l,o,n){let i=function(...e){for(let t of e)if(!R.isUndefined(t))return t}(I.themeStyle[l],o);n&&(i=n(i)),a.push(`.${le} ${e}{${t}:${i}}`)};return p(".help-title,.help-group","color","fontColor","#ceb78b"),p(".help-title,.help-group","text-shadow","fontShadow","none"),p(".help-desc","color","descColor","#eee"),p(".cont-box","background","contBgColor","rgba(43, 52, 61, 0.8)"),p(".cont-box","backdrop-filter","contBgBlur",3,(t=>!1===(null==e?void 0:e.bgBlur)?"none":`blur(${t}px)`)),p(".help-group","background","headerBgColor","rgba(34, 41, 51, .4)"),p(".help-table .tr:nth-child(odd)","background","rowBgColor1","rgba(34, 41, 51, .2)"),p(".help-table .tr:nth-child(even)","background","rowBgColor2","rgba(34, 41, 51, .4)"),{style:`${a.join("\n")}`,width:o,colCount:t}}();e.style&&U(e.style,le),re.value=e.width||850,se.value=e.colCount},ce=S(pe,300);g([()=>I.helpCfg,()=>I.themeName],ce,{immediate:!0,deep:!0}),g((()=>I.themeStyle),pe,{immediate:!0,deep:!0}),g(re,(e=>{document.body.clientWidth>=e?ie.value=1:ie.value=parseFloat((document.body.clientWidth/e).toFixed(4))}),{immediate:!0}),h([{event:"changeBackground",text:"更换背景",icon:"akar-icons:image",onClick(){ue("upload-bg",(e=>{p("update:mainB64",e)}))}},{event:"uploadIcon",text:"上传图标",icon:"fontisto:nav-icon-grid",onClick(){let e=()=>{ue("upload-icon",(e=>s(this,null,(function*(){let t=yield F(e);p("update:iconB64List",t),oe.success("上传成功")}))))};!0===ee.get("hide-upload-icon-help-modal",!1)?e():ne.openModal(!0,e)}}]),g((()=>I.themeName),(e=>s(this,null,(function*(){p("update:themeStyle",yield z(e))}))),{immediate:!0});const de={};function ue(e,t){let l=document.getElementById(e);de[e]||(de[e]=!0,l.addEventListener("change",(e=>{let o=e.target.files;if(0!==o.length){let e=o[0],a=new FileReader;a.readAsDataURL(e),a.onload=()=>{t(a.result),l.value=null}}}))),l.click()}const me=(e,t,l,o)=>{var a,n;let i=!0;(null==(a=I.modelData)?void 0:a.show)&&e&&e===(null==(n=I.modelData)?void 0:n.cell)&&(i=!1),p("update:modelData",{show:i,cell:e,cellIndex:t,group:l,groupIndex:o})};function he(){var e;p("open-setting"),p("update:modelData",(e=((e,t)=>{for(var l in t||(t={}))a.call(t,l)&&i(e,l,t[l]);if(o)for(var l of o(t))n.call(t,l)&&i(e,l,t[l]);return e})({},I.modelData),t(e,l({show:!1}))))}return(t,l)=>{const o=b("Icon"),a=b("a-button");return f(),v("div",{class:M([k(le)]),style:C(`transform: scale(${ie.value});transform-origin: center top;`)},[y("div",A,[y("div",H,[W,T,B(a,{style:C(`transform: scale(${1/ie.value});transform-origin: right top;`),type:"primary",shape:"circle",size:"large",onClick:he},{default:j((()=>[B(o,{icon:"ion:settings-outline"})])),_:1},8,["style"])]),y("div",V,[y("div",_,[y("div",q,x(e.helpCfg.title),1),y("div",Y,x(e.helpCfg.subTitle),1)])]),(f(!0),v($,null,L(e.helpList,((t,l)=>{var o;return f(),v("div",{class:"cont-box",key:l},[y("div",{class:"help-group",onClick:e=>me(null,null,t,l)},[y("span",null,x(t.group),1)],8,G),(null==(o=t.list)?void 0:o.length)?(f(),w(k(N),{key:0,list:t.list,colCount:se.value,iconB64List:e.iconB64List,modelData:e.modelData,onOpen:(e,o)=>me(e,o,t,l)},null,8,["list","colCount","iconB64List","modelData","onOpen"])):D("",!0)])})),128)),y("div",J,[K,y("span",Q,x(e.versions.yunzai),1),X,y("span",Z,x(e.versions.miao),1)])]),B(r,{panelCls:k(le),helpList:e.helpList,"onUpdate:helpList":l[0]||(l[0]=e=>O(helpList)?helpList.value=e:null),modelData:e.modelData,"onUpdate:modelData":l[1]||(l[1]=e=>O(modelData)?modelData.value=e:null),iconB64List:e.iconB64List,"onUpdate:iconB64List":l[2]||(l[2]=e=>O(iconB64List)?iconB64List.value=e:null)},null,8,["panelCls","helpList","modelData","iconB64List"]),B(E,{onRegister:k(ae)},null,8,["onRegister"])],6)}}});export{ee as default};
