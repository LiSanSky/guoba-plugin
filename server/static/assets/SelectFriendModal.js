var e=Object.defineProperty,t=Object.defineProperties,l=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,s=(t,l,o)=>l in t?e(t,l,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[l]=o,i=(e,t)=>{for(var l in t||(t={}))n.call(t,l)&&s(e,l,t[l]);if(o)for(var l of o(t))a.call(t,l)&&s(e,l,t[l]);return e},r=(e,o)=>t(e,l(o)),c=(e,t,l)=>new Promise(((o,n)=>{var a=e=>{try{i(l.next(e))}catch(t){n(t)}},s=e=>{try{i(l.throw(e))}catch(t){n(t)}},i=e=>e.done?o(e.value):Promise.resolve(e.value).then(a,s);i((l=l.apply(e,t)).next())}));import{B as u}from"./TableImg.js";import{p as d,v as m,r as p,c as f,w as h,H as g,e9 as v,b as x,V as b,fX as w,s as S,W as y,ap as C,l as R,e as j,m as O,a as I,o as P,i as k,k as K,y as _,D as T,z as B}from"./index.js";import"./index6.js";import"./index8.js";import"./onMountedOrActivated.js";import"./useContentViewHeight.js";import"./ArrowLeftOutlined.js";import"./merge.js";import"./sortable.esm.js";import"./RedoOutlined.js";import"./scrollTo.js";import"./index13.js";import"./index14.js";const V={isRadioSelection:d.bool.def(!1),rowKey:d.string.def("id"),labelKey:d.string.def("name"),params:d.object.def((()=>({}))),showButton:d.bool.def(!0),showSelected:d.bool.def(!1),maxSelectCount:d.number.def(0),modalTitle:d.string.def("选择")};function z(e,t){const l=m("selectOptions",p([])),o=m("selectValues",f({value:[],change:!1})),n=m("loadingEcho",p(!1)),a=p([]),s=p([]),i=p([]),r=v();let u=!0;function d(l,o){return c(this,null,(function*(){if(s.value=l,t.showSelected&&g(s).length!==g(o).length){let{records:t}=yield e({code:g(s).join(","),pageSize:g(s).length});i.value=t}else i.value=o}))}h(o,(()=>{if(0==o.change){let e={};e[t.rowKey]=o.value.join(","),n.value=u,u=!1,b(e,!0).then().finally((()=>{n.value=u}))}s.value=o.value}),{immediate:!0});const x={type:t.isRadioSelection?"radio":"checkbox",columnWidth:40,selectedRowKeys:s,onChange:d};function b(o,n){return c(this,null,(function*(){let{records:s}=yield e(o);if(a.value=s,n){let e=[];s.forEach((l=>{e.push({label:l[t.labelKey],value:l[t.rowKey]})})),l.value=e}}))}return[{onSelectChange:d,getDataSource:b,visibleChange:function(l){return c(this,null,(function*(){l&&t.showSelected&&function(){c(this,null,(function*(){let{records:t}=yield e({code:o.value.join(","),pageSize:o.value.length});s.value=o.value,i.value=t}))}()}))},selectOptions:l,selectValues:o,rowSelection:x,indexColumnProps:{dataIndex:"index",title:"#",width:40},checkedKeys:s,selectRows:i,dataSource:a,getSelectResult:function(e){let o=[],n=[];if(i.value.forEach((e=>{o.push({label:e[t.labelKey],value:e[t.rowKey]})})),s.value.forEach((e=>{n.push(e)})),l.value=o,t.maxSelectCount&&n.length>t.maxSelectCount)return r.createMessage.warning(`最多只能选择${t.maxSelectCount}条数据`),!1;e&&e(o,n)},handleDeleteSelected:function(e){s.value=s.value.splice(s.value.indexOf(e.id),1),i.value=i.value.filter((t=>t.id!==e.id))},reset:function(){s.value=[],i.value=[]}}]}function D(e){return C.get({url:"/oicq/friend/list",params:e})}var q=x({name:"UserSelectModal",components:{BasicModal:b,BasicTable:u,FormItemRest:w},props:r(i({},V),{modalTitle:d.string.def("选择好友")}),emits:["register","getSelectResult"],setup(e,{emit:t}){const l=S(),o=p(),n=Object.assign({},g(e),g(l),{canResize:!1,bordered:!0,size:"small"}),[{rowSelection:a,visibleChange:s,selectValues:c,indexColumnProps:u,getSelectResult:d,handleDeleteSelected:m,selectRows:f}]=z(D,n),h=p({x:!1}),[v,{closeModal:x}]=y((()=>{window.innerWidth<900?h.value={x:900}:h.value={x:!1},setTimeout((()=>{o.value&&o.value.setSelectedRowKeys(c.value||[])}),800)})),b=[{title:"头像",dataIndex:"user_id",width:60,customRender:({text:e})=>R(j("g-avatar"),{id:e,qs:100},null)},{title:"QQ号",dataIndex:"user_id",width:120},{title:"昵称",dataIndex:"nickname",ellipsis:!0,align:"left",customRender:({text:e,record:t})=>t.remark!==e?R("span",null,[R("span",null,[t.remark]),R("span",{style:"color:#999;font-size:8px;"},[O("（"),e,O("）")])]):e},{title:"性别",dataIndex:"sex",width:60,customRender:({text:e})=>"female"===e?"女":"male"===e?"男":e}];return{handleOk:function(){d(((e,l)=>{t("getSelectResult",e,l),x()}))},searchInfo:p(e.params),register:v,indexColumnProps:u,visibleChange:s,getBindValue:n,getFriendList:D,formConfig:{baseColProps:{xs:24,sm:8,md:6,lg:8,xl:8,xxl:8},actionColOptions:{xs:24,sm:8,md:8,lg:8,xl:8,xxl:8,style:{paddingLeft:"8px",textAlign:"left"}},labelCol:{xs:24,sm:6},wrapperCol:{xs:24,sm:18},schemas:[{label:"QQ号",field:"query_qq",component:"Input",componentProps:{placeholder:"请输入QQ号"}},{label:"昵称",field:"query_name",component:"Input",componentProps:{placeholder:"请输入昵称"}}],autoSubmitOnEnter:!0},columns:b,rowSelection:a,selectRows:f,selectedTable:{rowKey:"user_id",size:"small",bordered:!0,scroll:{y:390},canResize:!1,pagination:!1,showIndexColumn:!1,columns:[b[0],r(i({},b[1]),{show:!1}),b[2]]},handleDeleteSelected:m,tableScroll:h,tableRef:o}}});const E=["onClick"];var F=I(q,[["render",function(e,t,l,o,n,a){const s=j("BasicTable"),i=j("a-col"),r=j("Icon"),c=j("a-row"),u=j("BasicModal"),d=j("FormItemRest");return P(),k(d,null,{default:K((()=>[R(u,_({width:"800px",title:e.modalTitle,onOk:e.handleOk,onRegister:e.register,onVisibleChange:e.visibleChange},e.$attrs),{default:K((()=>[R(c,null,{default:K((()=>[R(i,{span:e.showSelected?18:24},{default:K((()=>[R(s,_({ref:"tableRef",columns:e.columns,scroll:e.tableScroll},e.getBindValue,{useSearchForm:!0,formConfig:e.formConfig,api:e.getFriendList,searchInfo:e.searchInfo,rowSelection:e.rowSelection,indexColumnProps:e.indexColumnProps}),null,16,["columns","scroll","formConfig","api","searchInfo","rowSelection","indexColumnProps"])])),_:1},8,["span"]),e.showSelected?(P(),k(i,{key:0,span:6},{default:K((()=>[R(s,_(e.selectedTable,{dataSource:e.selectRows,useSearchForm:!0,formConfig:{showActionButtonGroup:!1,baseRowStyle:{minHeight:"40px"}}}),{action:K((({record:t})=>[T("a",{onClick:l=>e.handleDeleteSelected(t)},[R(r,{icon:"ant-design:delete-outlined"})],8,E)])),_:1},16,["dataSource"])])),_:1})):B("",!0)])),_:1})])),_:1},16,["title","onOk","onRegister","onVisibleChange"])])),_:1})}]]);export{F as default};
