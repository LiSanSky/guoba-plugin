var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,o=(t,n,i)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[n]=i,l=(e,t)=>{for(var n in t||(t={}))r.call(t,n)&&o(e,n,t[n]);if(i)for(var n of i(t))a.call(t,n)&&o(e,n,t[n]);return e},s=(e,t,n)=>new Promise(((i,r)=>{var a=e=>{try{l(n.next(e))}catch(t){r(t)}},o=e=>{try{l(n.throw(e))}catch(t){r(t)}},l=e=>e.done?i(e.value):Promise.resolve(e.value).then(a,o);l((n=n.apply(e,t)).next())}));import{a as m,B as u}from"./index28.js";import{b as p,bw as c,bK as d,du as f,r as y,v as g,x as j,e as v,o as h,i as w,j as b,k as x,z as k,bJ as O,bO as P,m as _,A as C,B as L,l as N,bP as $}from"./index.js";import{u as B}from"./usePrompt.js";import"./Prompt.js";import{c as F,d as I,p as S,e as T}from"./miao.api.js";import M from"./ThemeConfigModal.js";import{b as D}from"./index3.js";import"./index9.js";import"./ArrowLeftOutlined.js";import"./BasicForm.js";import"./index2.js";import"./find.js";import"./_baseIteratee.js";import"./get.js";import"./index4.js";import"./index5.js";import"./useFormItem.js";import"./transButton.js";import"./upperFirst.js";import"./download.js";import"./index6.js";import"./index7.js";import"./uniqBy.js";import"./useForm.js";import"./base64Conver.js";import"./miao.data.js";import"./lodash.default.js";import"./throttle.js";import"./merge.js";import"./useWindowSizeFn.js";import"./FullscreenOutlined.js";const R={style:{"margin-bottom":"8px"}},z=N("新增皮肤"),A={class:"theme-desc"},E=["src"],q=p({__name:"ThemeDrawer",props:{themeNames:Array},emits:["register","reload","update:themeNames"],setup(e,{emit:i}){const r=e,a=c(),{prefixCls:o}=d("miao-plugin-theme-drawer"),{createMessage:p,createConfirm:N}=$(),{createPrompt:q}=B(),J=f(),W=y(),K=y(!1),G=y([]),[H,{closeDrawer:Q,setDrawerProps:U}]=m((function(){te()})),[V,X]=D(),Y=g((()=>{let e={width:document.body.clientWidth>=768?700:"100%",title:"喵喵帮助皮肤",confirmLoading:j(K)};var i;return i=l(l(l({},j(a)),e),r),t(i,n({onOk:ne,onCancel:ne,onRegister:H}))}));let Z={};function ee(e,t="main"){let n=Z[e]||1;return`/api/plugin/miao/help/theme/$s?token=${J.liteToken}&themeName=${e}&_v=${n}`.replace("$s",t)}function te(){return s(this,null,(function*(){try{oe(!0),G.value=yield F();let e=G.value.map((e=>e.name));i("update:themeNames",e)}finally{oe(!1)}}))}function ne(){Q()}let ie=null;function re(){return W.value.value="",W.value.click(),new Promise((e=>{let t=!1,n=()=>{setTimeout((()=>{t||e(null)}),500)},i=i=>{t||(t=!0,window.removeEventListener("focus",n),e(i))};window.addEventListener("focus",n),ie=function(e){return s(this,null,(function*(){var t;let n=null==(t=null==e?void 0:e.target)?void 0:t.files;n&&n.length<=0?i(null):i(n[0])}))}}))}function ae(){q({title:"新增皮肤",required:!0,placeholder:"请输入皮肤名称",okText:"确定并选择底图",onOk(e){return s(this,null,(function*(){let t=yield re();if(!t)return Promise.reject("未选择底图");yield I(e,t),yield te()}))}})}function oe(e){K.value=e,U({confirmLoading:e})}function le(e){"function"==typeof ie&&(ie(e),ie=null)}function se(e){return[{event:"change",text:"修改配置",icon:"ant-design:edit",onClick(){X.openModal(!0,e)}},{event:"changePic",text:"更改底图",icon:"akar-icons:image",onClick(){return s(this,null,(function*(){try{oe(!0);let t=yield re();if(t){yield S(e.name,t);let n=Z[e.name]||1;Z[e.name]=++n}}finally{oe(!1)}}))}},{event:"delete",text:"删除皮肤",icon:"ant-design:delete",onClick(){N({title:"删除",iconType:"warning",content:`确定要删除“${e.name}”吗？删除后不可恢复！`,onOk:()=>function(e){return s(this,null,(function*(){try{if("default"===e.name)return void p.warn("默认皮肤不可删除");oe(!0),yield T(e.name),yield te()}finally{oe(!1)}}))}(e)})}}]}return(e,t)=>{const n=v("a-button"),i=v("a-col"),r=v("a-row"),a=v("a-list-item-meta"),l=v("a-list-item"),s=v("a-list"),m=v("a-spin");return h(),w(j(u),C(L(j(Y))),{default:b((()=>[x(m,{wrapperClassName:`${j(o)} p-2`,spinning:K.value},{default:b((()=>[k("div",R,[x(n,{type:"primary",preIcon:"ant-design:plus",onClick:ae},{default:b((()=>[z])),_:1})]),x(s,{size:"large",bordered:"",dataSource:G.value},{renderItem:b((({item:e})=>[x(l,null,{actions:b((()=>["default"!==e.name?(h(),w(j(O),{key:0,trigger:["click"],dropMenuList:se(e)},{default:b((()=>[x(n,{type:"primary",shape:"circle",preIcon:"ant-design:setting"})])),_:2},1032,["dropMenuList"])):P("",!0)])),default:b((()=>[x(a,{title:e.name},{description:b((()=>[k("div",A,[x(r,{type:"flex",gutter:8},{default:b((()=>[x(i,{style:{width:"150px"}},{default:b((()=>[k("img",{src:ee(e.name),alt:"皮肤底图"},null,8,E)])),_:2},1024),x(i,{style:{flex:"1"}},{default:b((()=>[k("pre",null,_(JSON.stringify(e.style,null,2)),1)])),_:2},1024)])),_:2},1024)])])),_:2},1032,["title"])])),_:2},1024)])),_:1},8,["dataSource"])])),_:1},8,["wrapperClassName","spinning"]),x(M,{onRegister:j(V),onSuccess:te},null,8,["onRegister"]),k("input",{ref_key:"uploadBgRef",ref:W,type:"file",name:"upload-bg",accept:"image/bmp,image/jpeg,image/png",onCancel:t[0]||(t[0]=()=>j(p).warn("取消了选择")),onChange:le,style:{display:"none"}},null,544)])),_:1},16)}}});export{q as default};
