var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,l=(t,n,a)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[n]=a,o=(e,t)=>{for(var n in t||(t={}))i.call(t,n)&&l(e,n,t[n]);if(a)for(var n of a(t))r.call(t,n)&&l(e,n,t[n]);return e},s=(e,t,n)=>new Promise(((a,i)=>{var r=e=>{try{o(n.next(e))}catch(t){i(t)}},l=e=>{try{o(n.throw(e))}catch(t){i(t)}},o=e=>e.done?a(e.value):Promise.resolve(e.value).then(r,l);o((n=n.apply(e,t)).next())}));import{a as u,B as c}from"./index23.js";import{b as m,s as p,U as d,b4 as f,r as y,E as g,R as v,H as h,e as w,o as b,i as j,k,l as x,D as O,bz as C,z as P,q as _,X as L,Y as N,m as $,e9 as M,u as R}from"./index.js";import{p as S,c as T,d as D,e as E}from"./miao.api.js";import I from"./ThemeConfigModal.js";import"./index3.js";import"./ArrowLeftOutlined.js";import"./base64Conver.js";import"./miao.data.js";import"./lodash.default.js";import"./throttle.js";import"./merge.js";const z={style:{"margin-bottom":"8px"}},q=$("新增皮肤"),A={class:"theme-desc"},B=["src"],H=m({props:{themeNames:Array},emits:["register","reload","update:themeNames"],setup(e,{emit:a}){const i=e,r=p(),{prefixCls:l}=d("miao-plugin-theme-drawer"),{createMessage:m,createConfirm:$}=M(),{createPrompt:H}=R(),J=f(),U=y(),W=y(!1),X=y([]),[Y,{closeDrawer:F,setDrawerProps:G}]=u((function(){te()})),[K,Q]=g(),V=v((()=>{let e={width:document.body.clientWidth>=768?700:"100%",title:"喵喵帮助皮肤",confirmLoading:h(W)};var a;return a=o(o(o({},h(r)),e),i),t(a,n({onOk:ne,onCancel:ne,onRegister:Y}))}));let Z={};function ee(e,t="main"){let n=Z[e]||1;return`/api/plugin/miao/help/theme/$s?token=${J.liteToken}&themeName=${e}&_v=${n}`.replace("$s",t)}function te(){return s(this,null,(function*(){try{le(!0),X.value=yield T();let e=X.value.map((e=>e.name));a("update:themeNames",e)}finally{le(!1)}}))}function ne(){F()}let ae=null;function ie(){return U.value.value="",U.value.click(),new Promise((e=>{let t=!1,n=()=>{setTimeout((()=>{t||e(null)}),500)},a=a=>{t||(t=!0,window.removeEventListener("focus",n),e(a))};window.addEventListener("focus",n),ae=function(e){return s(this,null,(function*(){var t;let n=null==(t=null==e?void 0:e.target)?void 0:t.files;n&&n.length<=0?a(null):a(n[0])}))}}))}function re(){H({title:"新增皮肤",required:!0,placeholder:"请输入皮肤名称",okText:"确定并选择底图",onOk(e){return s(this,null,(function*(){let t=yield ie();if(!t)return Promise.reject("未选择底图");yield D(e,t),yield te()}))}})}function le(e){W.value=e,G({confirmLoading:e})}function oe(e){"function"==typeof ae&&(ae(e),ae=null)}function se(e){return[{event:"change",text:"修改配置",icon:"ant-design:edit",onClick(){Q.openModal(!0,e)}},{event:"changePic",text:"更改底图",icon:"akar-icons:image",onClick(){return s(this,null,(function*(){try{le(!0);let t=yield ie();if(t){yield S(e.name,t);let n=Z[e.name]||1;Z[e.name]=++n}}finally{le(!1)}}))}},{event:"delete",text:"删除皮肤",icon:"ant-design:delete",onClick(){$({title:"删除",iconType:"warning",content:`确定要删除“${e.name}”吗？删除后不可恢复！`,onOk:()=>function(e){return s(this,null,(function*(){try{if("default"===e.name)return void m.warn("默认皮肤不可删除");le(!0),yield E(e.name),yield te()}finally{le(!1)}}))}(e)})}}]}return(e,t)=>{const n=w("a-button"),a=w("a-col"),i=w("a-row"),r=w("a-list-item-meta"),o=w("a-list-item"),s=w("a-list"),u=w("a-spin");return b(),j(h(c),L(N(h(V))),{default:k((()=>[x(u,{wrapperClassName:`${h(l)} p-2`,spinning:W.value},{default:k((()=>[O("div",z,[x(n,{type:"primary",preIcon:"ant-design:plus",onClick:re},{default:k((()=>[q])),_:1})]),x(s,{size:"large",bordered:"",dataSource:X.value},{renderItem:k((({item:e})=>[x(o,null,{actions:k((()=>["default"!==e.name?(b(),j(h(C),{key:0,trigger:["click"],dropMenuList:se(e)},{default:k((()=>[x(n,{type:"primary",shape:"circle",preIcon:"ant-design:setting"})])),_:2},1032,["dropMenuList"])):P("",!0)])),default:k((()=>[x(r,{title:e.name},{description:k((()=>[O("div",A,[x(i,{type:"flex",gutter:8},{default:k((()=>[x(a,{style:{width:"150px"}},{default:k((()=>[O("img",{src:ee(e.name),alt:"皮肤底图"},null,8,B)])),_:2},1024),x(a,{style:{flex:"1"}},{default:k((()=>[O("pre",null,_(JSON.stringify(e.style,null,2)),1)])),_:2},1024)])),_:2},1024)])])),_:2},1032,["title"])])),_:2},1024)])),_:1},8,["dataSource"])])),_:1},8,["wrapperClassName","spinning"]),x(I,{onRegister:h(K),onSuccess:te},null,8,["onRegister"]),O("input",{ref_key:"uploadBgRef",ref:U,type:"file",name:"upload-bg",accept:"image/bmp,image/jpeg,image/png",onChange:oe,style:{display:"none"}},null,544)])),_:1},16)}}});export{H as default};
