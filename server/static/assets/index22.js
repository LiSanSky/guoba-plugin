var e=(e,a,t)=>new Promise(((n,o)=>{var l=e=>{try{i(t.next(e))}catch(a){o(a)}},r=e=>{try{i(t.throw(e))}catch(a){o(a)}},i=e=>e.done?n(e.value):Promise.resolve(e.value).then(l,r);i((t=t.apply(e,a)).next())}));import{a,b as t,U as n,r as o,c as l,w as r,e as i,o as m,i as s,k as p,l as u,D as d,z as h,bp as c,x as g,e9 as f}from"./index.js";import{P as v}from"./index6.js";import y from"./MiaoHeader.js";import j from"./HelpPanel.js";import D from"./ThemeDrawer.js";import B from"./BackupDrawer.js";import N from"./SettingDrawer.js";import{s as w,g as x,a as S}from"./miao.api.js";import{u as C}from"./index23.js";import{l as T}from"./lodash.default.js";import"./index8.js";import"./onMountedOrActivated.js";import"./useContentViewHeight.js";import"./ArrowLeftOutlined.js";import"./EditBodyModal.js";import"./SelectIconModal.js";import"./IconUploader.js";import"./esm.js";import"./common.js";import"./HelpComps.js";import"./UploadIconHelpModal.js";import"./21ae6624.js";import"./ThemeConfigModal.js";import"./miao.data.js";import"./ThemeConfigForm.js";import"./base64Conver.js";import"./index3.js";import"./throttle.js";import"./merge.js";const b=t({name:"MiaoPluginExtra",components:{HelpPanel:j,EditMiaoHeader:y,PageWrapper:v,ThemeDrawer:D,BackupDrawer:B,SettingDrawer:N},setup(){const{prefixCls:a}=n("edit-miao-help"),{createMessage:t,createConfirm:i}=f(),m=o(!0),s=o(!0),p=o(0),u=o(null),d=o(null),h=o(null),c=o(null),g=o(null),v=l({miao:"x.x.x",yunzai:"x.x.x"}),y=o({show:!1,cell:null,cellIndex:null,group:null,groupIndex:null}),j=o([]),D=o({}),B=o(""),N=o();let b=null;r([B,()=>{var e;return null==(e=u.value)?void 0:e.theme},()=>{var e;return null==(e=u.value)?void 0:e.themeExclude}],(()=>{N.value=(()=>{var e,a;if("string"==typeof b)return b;if(B.value)return B.value;let t=[],n=null==(e=u.value)?void 0:e.theme,o=null==(a=u.value)?void 0:a.themeExclude,l=j.value;T.isArray(n)?t=T.intersection(n,l):"all"===n&&(t=l),o&&T.isArray(o)&&(t=T.difference(t,o)),0===t.length&&(t=["default"]);let r=T.sample(t);return l&&l.length>0&&null==b&&(b=r),r})()}),{deep:!0,immediate:!0});const[k,L]=C(),[U,M]=C(),[R,H]=C();const O=()=>e(this,null,(function*(){try{s.value=!0;let e=yield x();u.value=e.helpCfg,d.value=e.helpList,j.value=e.themeNames,v.miao=e.miaoVersion,v.yunzai=e.yunzaiVersion,h.value=null,c.value=null,g.value=yield S()}finally{s.value=!1,m.value=!1,p.value++}}));return O(),{prefixCls:a,loading:s,pageLoading:m,helpCfg:u,helpList:d,themeNames:j,themeStyle:D,themeName:N,debugThemeName:B,bgB64:h,mainB64:c,iconB64List:g,cacheVer:p,versions:v,modelData:y,onBackup:function(){M.openDrawer(!0,{})},onOpenTheme:function(){L.openDrawer(!0,{})},onRollback:function(){i({title:"提示",iconType:"warning",content:"确定要放弃所有修改吗？",onOk:()=>{O()}})},onOpenSetting:function(){H.openDrawer()},loadData:O,saveData:()=>e(this,null,(function*(){try{s.value=!0,yield w(u,d,g,c),yield O(),t.success("保存成功~")}finally{s.value=!1}})),onSettingModalChange:function(){setTimeout((()=>b=-1),300)},registerThemeDrawer:k,registerBackupDrawer:U,registerSettingDrawer:R}}}),k={class:"flex justify-center md:pt-4 my-4"};var L=a(b,[["render",function(e,a,t,n,o,l){const r=i("EditMiaoHeader"),f=i("HelpPanel"),v=i("ThemeDrawer"),y=i("BackupDrawer"),j=i("SettingDrawer"),D=i("PageWrapper");return m(),s(D,{class:g([e.prefixCls]),title:"编辑喵喵帮助",dense:"",sticky:"",stickyTop:"-14px",loading:e.loading},{headerContent:p((()=>[u(r,{onSave:e.saveData,onRollback:e.onRollback,onBackup:e.onBackup,onTheme:e.onOpenTheme},null,8,["onSave","onRollback","onBackup","onTheme"])])),default:p((()=>[d("div",k,[u(c,{name:"scroll-y-reverse-transition"},{default:p((()=>[e.pageLoading?h("",!0):(m(),s(f,{key:0,cacheVer:e.cacheVer,versions:e.versions,themeNames:e.themeNames,helpCfg:e.helpCfg,"onUpdate:helpCfg":a[0]||(a[0]=a=>e.helpCfg=a),helpList:e.helpList,"onUpdate:helpList":a[1]||(a[1]=a=>e.helpList=a),bgB64:e.bgB64,"onUpdate:bgB64":a[2]||(a[2]=a=>e.bgB64=a),mainB64:e.mainB64,"onUpdate:mainB64":a[3]||(a[3]=a=>e.mainB64=a),iconB64List:e.iconB64List,"onUpdate:iconB64List":a[4]||(a[4]=a=>e.iconB64List=a),modelData:e.modelData,"onUpdate:modelData":a[5]||(a[5]=a=>e.modelData=a),themeStyle:e.themeStyle,"onUpdate:themeStyle":a[6]||(a[6]=a=>e.themeStyle=a),themeName:e.themeName,"onUpdate:themeName":a[7]||(a[7]=a=>e.themeName=a),onOpenSetting:e.onOpenSetting},null,8,["cacheVer","versions","themeNames","helpCfg","helpList","bgB64","mainB64","iconB64List","modelData","themeStyle","themeName","onOpenSetting"]))])),_:1})]),u(v,{themeNames:e.themeNames,"onUpdate:themeNames":a[8]||(a[8]=a=>e.themeNames=a),onRegister:e.registerThemeDrawer},null,8,["themeNames","onRegister"]),u(y,{onRegister:e.registerBackupDrawer,onReload:e.loadData},null,8,["onRegister","onReload"]),u(j,{model:e.helpCfg,"onUpdate:model":[a[9]||(a[9]=a=>e.helpCfg=a),e.onSettingModalChange],themeName:e.themeName,themeNames:e.themeNames,themeStyle:e.themeStyle,"onUpdate:themeStyle":a[10]||(a[10]=a=>e.themeStyle=a),debugThemeName:e.debugThemeName,"onUpdate:debugThemeName":a[11]||(a[11]=a=>e.debugThemeName=a),onRegister:e.registerSettingDrawer},null,8,["model","themeName","themeNames","themeStyle","debugThemeName","onRegister","onUpdate:model"])])),_:1},8,["class","loading"])}]]);export{L as default};
